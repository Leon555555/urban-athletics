{% extends "layout.html" %}

{% block title %}Perfil de {{ atleta.nombre }}{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="row">
    
    <!-- Sidebar -->
    <div id="sidebar" class="col-md-3 bg-black text-light sidebar vh-100 p-3">
      <div class="text-center mb-4">
        <img src="{{ url_for('static', filename='img/logo_urban_blanco.png') }}" alt="Logo Urban" class="img-fluid" style="max-height: 80px;">
        <h4 class="mt-3">{{ atleta.nombre }}</h4>
      </div>
      <div class="nav flex-column nav-pills">
        <button class="nav-link active text-start" data-section="home">🏠 Home</button>
        <button class="nav-link text-start" data-section="datos">📄 Datos personales</button>
        <button class="nav-link text-start" data-section="editar">✏️ Editar perfil</button>
        <a class="nav-link text-start" href="{{ url_for('main.entrena_en_casa') }}">🏡 Entrena en casa</a>
        <a class="nav-link text-danger mt-5 text-start" href="{{ url_for('main.logout') }}">🚪 Cerrar sesión</a>
      </div>
    </div>

    <!-- Main -->
    <div id="main" class="col-md-9 p-4">

      <!-- Botón para mostrar/ocultar el sidebar -->
      <button id="menuToggle" class="btn btn-outline-light mb-4 d-md-none">☰ Menú</button>

      <!-- Home -->
      <div id="seccion-home">
        <div class="row mb-4">
          <div class="col-md-6">
            <div class="card bg-dark text-light shadow">
              <div class="card-header bg-success">📅 Próximos entrenamientos</div>
              <ul class="list-group list-group-flush">
                {% for e in entrenamientos_planificados %}
                  <li class="list-group-item bg-dark text-light d-flex justify-content-between">
                    <span><strong>{{ e.fecha.strftime('%d/%m/%Y') }}</strong>: {{ e.detalle or 'Sin descripción' }}</span>
                    <button class="btn btn-sm btn-outline-light ver-detalle-btn"
                            data-bs-toggle="modal" data-bs-target="#modalEntrenamiento"
                            data-id="{{ e.id }}" data-detalle="{{ e.detalle }}">
                      Ver
                    </button>
                  </li>
                {% else %}
                  <li class="list-group-item text-muted">No hay entrenamientos planificados.</li>
                {% endfor %}
              </ul>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card bg-dark text-light shadow">
              <div class="card-header bg-info text-dark">✅ Entrenamientos realizados</div>
              <ul class="list-group list-group-flush">
                {% for e in entrenamientos_realizados %}
                  <li class="list-group-item bg-dark text-light"><strong>{{ e.fecha.strftime('%d/%m/%Y') }}:</strong> {{ e.detalle or 'Sin descripción' }}</li>
                {% else %}
                  <li class="list-group-item text-muted">No hay entrenamientos realizados.</li>
                {% endfor %}
              </ul>
            </div>
          </div>
        </div>

        <!-- Calendario mensual -->
        <div>
          <h4 class="mb-3">🗓️ Calendario mensual</h4>
          <table class="table table-dark table-bordered text-center">
            <thead class="table-light text-dark">
              <tr>
                <th>Lun</th><th>Mar</th><th>Mié</th><th>Jue</th><th>Vie</th><th>Sáb</th><th>Dom</th>
              </tr>
            </thead>
            <tbody>
              {% for semana in calendario_mensual %}
              <tr>
                {% for dia in semana %}
                  {% if dia == 0 %}
                    <td class="bg-secondary"></td>
                  {% else %}
                    <td class="{% if dia.entreno %}bg-success text-white{% endif %}">
                      {{ dia.numero }} {% if dia.entreno %}🏃{% endif %}
                    </td>
                  {% endif %}
                {% endfor %}
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <!-- Datos personales -->
      <div id="seccion-datos" class="d-none">
        <h3>📄 Datos personales</h3>
        <ul class="list-group">
          <li class="list-group-item bg-dark text-light">Email: {{ atleta.correo or '—' }}</li>
          <li class="list-group-item bg-dark text-light">Teléfono: {{ atleta.telefono or '—' }}</li>
          <li class="list-group-item bg-dark text-light">Edad: {{ atleta.edad or '—' }}</li>
          <li class="list-group-item bg-dark text-light">Altura: {{ atleta.altura or '—' }} cm</li>
          <li class="list-group-item bg-dark text-light">Peso: {{ atleta.peso or '—' }} kg</li>
        </ul>
      </div>

      <!-- Editar perfil -->
      <div id="seccion-editar" class="d-none">
        <h3>✏️ Editar perfil</h3>
        <form method="POST" action="{{ url_for('main.editar_perfil', atleta_id=atleta.id) }}" class="bg-dark p-4 rounded shadow">
          <div class="mb-3">
            <label for="nombre" class="form-label">Nombre</label>
            <input type="text" class="form-control" name="nombre" value="{{ atleta.nombre }}">
          </div>
          <!-- ...otros campos si quieres -->
          <button type="submit" class="btn btn-success">Guardar cambios</button>
        </form>
      </div>

      <!-- Modal -->
      <div class="modal fade" id="modalEntrenamiento" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content bg-dark text-light">
            <div class="modal-header">
              <h5 class="modal-title">Detalle del entrenamiento</h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <p id="detalle-entrenamiento">Cargando...</p>
              <div class="d-flex justify-content-between">
                <button id="btn-realizado" class="btn btn-success">✔ Realizado</button>
                <button class="btn btn-secondary" data-bs-dismiss="modal">❌ No realizado</button>
                <a id="strava-btn" href="#" class="btn btn-warning" target="_blank">🔗 Strava</a>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div> <!-- end main -->
  </div>
</div>
{% endblock %}
